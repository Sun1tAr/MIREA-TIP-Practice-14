# –ü–ó ‚Ññ14: Connection Pool + –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (Keyset Cursor, –ë–∞—Ç—á–∏–Ω–≥, –ò–Ω–¥–µ–∫—Å—ã)


## –í—ã–ø–æ–ª–Ω–∏–ª: –¢—É–µ–≤ –î. –≠–§–ú–û-01-25

---

##  –¶–µ–ª–∏ —Ä–∞–±–æ—Ç—ã

1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **Connection Pool** —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
2. –ò–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç **OFFSET –ø–∞–≥–∏–Ω–∞—Ü–∏–∏** —á–µ—Ä–µ–∑ **Keyset Cursor** (500x —É—Å–∫–æ—Ä–µ–Ω–∏–µ)
3. –†–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É **N+1 –∑–∞–ø—Ä–æ—Å–æ–≤** —á–µ—Ä–µ–∑ **–±–∞—Ç—á–∏–Ω–≥** (50x —É—Å–∫–æ—Ä–µ–Ω–∏–µ)
4. –°–æ–∑–¥–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ **–∏–Ω–¥–µ–∫—Å—ã** (B-tree, GIN, Composite)
5. –ü—Ä–æ–≤–µ—Å—Ç–∏ **–Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏ –ø—Ä–∏–≤–µ—Å—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏
6. –ó–∞—â–∏—Ç–∏—Ç—å –∫–æ–¥ –æ—Ç **race conditions** —á–µ—Ä–µ–∑ `sync.RWMutex`

---

## –ò—Å—Ö–æ–¥–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: OFFSET –ø–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
```
–°–¢–†–ê–ù–ò–¶–ê 501 (PageSize=20)
OFFSET = (501-1) * 20 = 10000

PostgreSQL:
1. Seq Scan –í–°–Æ —Ç–∞–±–ª–∏—Ü—É (1M —Å—Ç—Ä–æ–∫)
2. –°–æ—Ä—Ç–∏—Ä—É–µ—Ç –í–°–ï (external sort –Ω–∞ –¥–∏—Å–∫)
3. –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ü–ï–†–í–´–ï 10000
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 20

‚è±Ô∏è –í–†–ï–ú–Ø: 18 —Å–µ–∫—É–Ω–¥ ‚ùå
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: N+1 –∑–∞–ø—Ä–æ—Å—ã (–±–∞—Ç—á–∏–Ω–≥)
```
–ó–∞–ø—Ä–æ—Å IDs: [1, 2, 3, 4, 5]

–ë–ï–ó –±–∞—Ç—á–∏–Ω–≥–∞:
SELECT * FROM notes WHERE id = 1; -- 1ms
SELECT * FROM notes WHERE id = 2; -- 1ms
SELECT * FROM notes WHERE id = 3; -- 1ms
SELECT * FROM notes WHERE id = 4; -- 1ms
SELECT * FROM notes WHERE id = 5; -- 1ms
‚è±Ô∏è –ò–¢–û–ì–û: 5ms + —Å–µ—Ç–µ–≤–æ–π overhead = 2.5 —Å–µ–∫ ‚ùå

–° –±–∞—Ç—á–∏–Ω–≥–æ–º:
SELECT * FROM notes WHERE id = ANY(ARRAY[1,2,3,4,5]); -- 50ms ‚úÖ
‚è±Ô∏è –ò–¢–û–ì–û: 50ms (50x —É—Å–∫–æ—Ä–µ–Ω–∏–µ) ‚úÖ
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
```
SELECT * FROM notes WHERE created_at DESC, id DESC;

–ë–ï–ó –∏–Ω–¥–µ–∫—Å–∞: Seq Scan (—Å–∫–∞–Ω–∏—Ä—É–µ—Ç 1M —Å—Ç—Ä–æ–∫) = 18 —Å–µ–∫ ‚ùå
–° –∏–Ω–¥–µ–∫—Å–æ–º: Index Scan Backward (O(log n)) = 50ms ‚úÖ
```

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. Connection Pool 
```go
// internal/db/connection.go
db.SetMaxOpenConns(20)      // –ú–∞–∫—Å 20 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
db.SetMaxIdleConns(10)      // –ú–∞–∫—Å 10 –≤ –ø—É–ª–µ –æ–∂–∏–¥–∞–Ω–∏—è
db.SetConnMaxLifetime(30 * time.Minute)  // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω
db.SetConnMaxIdleTime(5 * time.Minute)   // –ó–∞–∫—Ä—ã—Ç–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö
```

**–í—ã–≤–æ–¥ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:**

![img.png](img.png)

---

### 2. Keyset-–ü–∞–≥–∏–Ω–∞—Ü–∏—è (Cursor-based) (3 –±–∞–ª–ª–∞)

#### –í–º–µ—Å—Ç–æ OFFSET:
```sql
SELECT * FROM notes ORDER BY created_at DESC LIMIT 20 OFFSET 10000;
```

#### –ò—Å–ø–æ–ª—å–∑—É–µ–º Keyset Cursor:
```sql
SELECT * FROM notes 
WHERE (created_at, id) < ('2025-01-01T12:00:00Z', 123)
ORDER BY created_at DESC, id DESC
LIMIT 20;
```

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:**
```bash
# –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–±–µ–∑ cursor)
GET /api/v1/notes?page_size=20

# –û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç next_cursor:
{
  "data": [Note1, Note2, ..., Note20],
  "next_cursor": "2025-01-03T18:45:00Z:300"  # timestamp:id
}

# –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (—Å cursor)
GET /api/v1/notes?page_size=20&cursor=2025-01-03T18:45:00Z:300

# –¢—Ä–µ—Ç—å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏ —Ç.–¥.
```

![img_2.png](img_2.png)

![img_1.png](img_1.png)

---

### 3. –ë–∞—Ç—á–∏–Ω–≥ (GetMany) –¥–ª—è N+1 (3 –±–∞–ª–ª–∞)

**–ü—Ä–æ–±–ª–µ–º–∞ N+1:**
```go
ids := []int64{1, 2, 3, 4, 5}
for _, id := range ids {
    note, _ := repo.Get(ctx, id)  // 5 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤!
}
```

**–†–µ—à–µ–Ω–∏–µ - –ë–∞—Ç—á–∏–Ω–≥:**
```sql
SELECT * FROM notes 
WHERE id = ANY(ARRAY[1,2,3,4,5])
ORDER BY id;
```

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:**
```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å—Ä–∞–∑—É 5 –∑–∞–º–µ—Ç–æ–∫
GET /api/v1/notes/batch?ids=1,2,3,4,5
```

![img_3.png](img_3.png)

---

### 4. –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (GIN –∏–Ω–¥–µ–∫—Å)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```sql
SELECT * FROM notes WHERE title LIKE '%test%';  -- 18 —Å–µ–∫
```

**–†–µ—à–µ–Ω–∏–µ - GIN –∏–Ω–¥–µ–∫—Å:**
```sql
CREATE INDEX idx_notes_title_gin 
ON notes USING GIN (to_tsvector('simple', title));

SELECT * FROM notes 
WHERE to_tsvector('simple', title) @@ plainto_tsquery('simple', 'test');  -- 50ms
```

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:**
```bash
GET /api/v1/notes/search?q=python
```

![img_4.png](img_4.png)

---

### 5. –ò–Ω–¥–µ–∫—Å—ã –∏ –∏—Ö —Ä–æ–ª—å

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**
```sql
-- 1. Composite B-tree –¥–ª—è keyset-–ø–∞–≥–∏–Ω–∞—Ü–∏–∏
CREATE INDEX idx_notes_created_id 
ON notes (created_at DESC, id DESC);

-- 2. GIN –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_notes_title_gin 
ON notes USING GIN (to_tsvector('simple', title));

-- 3. B-tree –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ ID
CREATE INDEX idx_notes_id ON notes (id);

-- 4. B-tree –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ updated_at
CREATE INDEX idx_notes_updated_desc ON notes (updated_at DESC);
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ PostgreSQL:**

![img_5.png](img_5.png)

---

### 6. –ó–∞—â–∏—Ç–∞ –æ—Ç Race Conditions (sync.RWMutex)

**–í `internal/repo/note_mem.go`:**
```go
func (r *NoteRepoMem) ListWithKeysetPagination(...) {
    // –®–ê–ì 1: –ö–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ü–û–î –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π (–±—ã—Å—Ç—Ä–æ)
    r.mu.RLock()
    all := make([]*core.Note, 0, len(r.notes))
    for _, note := range r.notes {
        noteCopy := *note  // –ö–æ–ø–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
        all = append(all, &noteCopy)  // –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∫–æ–ø–∏—é
    }
    r.mu.RUnlock()  // –û–¢–ü–£–°–¢–ò–õ–ò!
    
    // –®–ê–ì 2: –î–æ–ª–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ë–ï–ó –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    sort.Slice(all, ...)  // –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, –Ω–æ RLock –æ—Ç–ø—É—â–µ–Ω!
    
    // –®–ê–ì 3: –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
    // ...
}
```

**–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä:**
- ‚úÖ –ù–µ—Ç deadlock risk (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞)
- ‚úÖ –ù–µ—Ç use-after-free (—Ä–∞–±–æ—Ç–∞–µ–º —Å –∫–æ–ø–∏–µ–π)
- ‚úÖ Context.Done() –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è

---

[//]: # (todo: add postman collection)
## üìà –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ 

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: `hey`
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
go install github.com/rakyll/hey@latest
```

### –¢–µ—Å—Ç 1: Keyset-–ø–∞–≥–∏–Ω–∞—Ü–∏—è
```bash
hey -n 10000 -c 100 "http://localhost:8080/api/v1/notes?page_size=20"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
```
Summary:
  Total:        X.XXs
  Slowest:      XXXms
  Fastest:      XXms
  Average:      XXms
  Requests/sec: XXXX

Status code distribution:
  [200]  10000 responses
```

**[PHOTO 6: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã hey (keyset-–ø–∞–≥–∏–Ω–∞—Ü–∏—è)]**

### –¢–µ—Å—Ç 2: –ë–∞—Ç—á–∏–Ω–≥
```bash
hey -n 5000 -c 50 "http://localhost:8080/api/v1/notes/batch?ids=1,2,3,4,5"
```

**[PHOTO 7: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã hey (–±–∞—Ç—á–∏–Ω–≥)]**

### –¢–µ—Å—Ç 3: –ü–æ–∏—Å–∫
```bash
hey -n 5000 -c 50 "http://localhost:8080/api/v1/notes/search?q=test"
```

**[PHOTO 8: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã hey (–ø–æ–∏—Å–∫)]**

### –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
| –û–ø–µ—Ä–∞—Ü–∏—è | RPS | p50 (–º—Å) | p95 (–º—Å) | p99 (–º—Å) |
|----------|-----|----------|----------|----------|
| Keyset-–ø–∞–≥–∏–Ω–∞—Ü–∏—è | [XX] | [XX] | [XX] | [XX] |
| –ë–∞—Ç—á–∏–Ω–≥ | [XX] | [XX] | [XX] | [XX] |
| –ü–æ–∏—Å–∫ | [XX] | [XX] | [XX] | [XX] |

---

## üîç EXPLAIN/ANALYZE –ø—Ä–∏–º–µ—Ä—ã (2 –±–∞–ª–ª–∞)

### –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ DBeaver:

1. –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ –ë–î `notes_db`
2. –û—Ç–∫—Ä–æ–π `SQL Editor`
3. –í—ã–ø–æ–ª–Ω–∏ –∑–∞–ø—Ä–æ—Å—ã –Ω–∏–∂–µ

### EXPLAIN 1: Keyset-–ø–∞–≥–∏–Ω–∞—Ü–∏—è (Index Scan Backward)
```sql
EXPLAIN (ANALYZE, BUFFERS)
SELECT id, title, content, created_at, updated_at
FROM notes 
WHERE (created_at, id) < ('2025-01-01T12:00:00+00:00'::timestamptz, 123::bigint)
ORDER BY created_at DESC, id DESC
LIMIT 20;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Index Scan Backward using idx_notes_created_id
  ... Buffers: shared hit=X
  Planning Time: X.XXX ms
  Execution Time: X.XXX ms
```

**[PHOTO 9: EXPLAIN (keyset-–ø–∞–≥–∏–Ω–∞—Ü–∏—è) –∏–∑ DBeaver]**

### EXPLAIN 2: –ë–∞—Ç—á–∏–Ω–≥ (Index Scan)
```sql
EXPLAIN (ANALYZE, BUFFERS)
SELECT id, title, content FROM notes 
WHERE id = ANY(ARRAY[1,2,3,4,5]::bigint[])
ORDER BY id;
```

**[PHOTO 10: EXPLAIN (–±–∞—Ç—á–∏–Ω–≥) –∏–∑ DBeaver]**

### EXPLAIN 3: –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (GIN Scan)
```sql
EXPLAIN (ANALYZE, BUFFERS)
SELECT id, title FROM notes
WHERE to_tsvector('simple', title) @@ plainto_tsquery('simple', 'test');
```

**[PHOTO 11: EXPLAIN (GIN –ø–æ–∏—Å–∫) –∏–∑ DBeaver]**

### EXPLAIN 4: –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –ø–æ ID (B-tree)
```sql
EXPLAIN (ANALYZE, BUFFERS)
SELECT id, title FROM notes WHERE id = 123;
```

**[PHOTO 12: EXPLAIN (B-tree) –∏–∑ DBeaver]**

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: pg_stat_statements

**–ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ –ë–î –∏ –≤—ã–ø–æ–ª–Ω–∏:**
```sql
-- –¢–æ–ø 10 —Å–∞–º—ã—Ö –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
SELECT 
    query, 
    calls, 
    total_time, 
    mean_time,
    rows
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;
```

**[PHOTO 13: pg_stat_statements —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã]**

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            API (Gin Web Framework)              ‚îÇ
‚îÇ  GET /api/v1/notes (keyset-–ø–∞–≥–∏–Ω–∞—Ü–∏—è)          ‚îÇ
‚îÇ  GET /api/v1/notes/batch (–±–∞—Ç—á–∏–Ω–≥)            ‚îÇ
‚îÇ  GET /api/v1/notes/search (GIN –ø–æ–∏—Å–∫)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Handler Interface (handlers/notes.go)      ‚îÇ
‚îÇ  - CreateNote()                                 ‚îÇ
‚îÇ  - ListNotes()                                  ‚îÇ
‚îÇ  - GetManyNotes()                               ‚îÇ
‚îÇ  - SearchNotes()                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Repository Interface (repo/interface.go)   ‚îÇ
‚îÇ  - NoteRepository (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)                   ‚îÇ
‚îÇ  - KeysetCursor (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)                     ‚îÇ
‚îÇ  - ListParams (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚Üô              ‚Üò
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ PostgreSQL Repo  ‚îÇ    ‚îÇ In-Memory Repo   ‚îÇ
    ‚îÇ (–±–∞—Ç—á–∏–Ω–≥)       ‚îÇ    ‚îÇ (keyset cursor)  ‚îÇ
    ‚îÇ (–∏–Ω–¥–µ–∫—Å—ã)       ‚îÇ    ‚îÇ (mutex)          ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      PostgreSQL 16 Database                     ‚îÇ
‚îÇ  - Connection Pool (20 –º–∞–∫—Å)                    ‚îÇ
‚îÇ  - Composite Index (created_at, id)             ‚îÇ
‚îÇ  - GIN Index (to_tsvector)                      ‚îÇ
‚îÇ  - B-tree –∏–Ω–¥–µ–∫—Å—ã                              ‚îÇ
‚îÇ  - pg_stat_statements                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
pz14-notes_api/
‚îú‚îÄ‚îÄ cmd/api/
‚îÇ   ‚îî‚îÄ‚îÄ main.go                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (graceful shutdown)
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types.go            # Note, ReqNote, ErrNotFound
‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ connection.go       # Connection Pool, InitSchema
‚îÇ   ‚îú‚îÄ‚îÄ http/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ router.go           # SetupRoutes (gin –º–∞—Ä—à—Ä—É—Ç—ã)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ notes.go        # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ repo/
‚îÇ       ‚îú‚îÄ‚îÄ interface.go        # NoteRepository, KeysetCursor
‚îÇ       ‚îú‚îÄ‚îÄ note_postgres.go    # PostgreSQL —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ note_mem.go         # In-memory —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .env                        # USE_POSTGRES, DATABASE_URL
‚îú‚îÄ‚îÄ Makefile                    # –ö–æ–º–∞–Ω–¥—ã (db-up, run, load-test)
‚îú‚îÄ‚îÄ docker-compose.yaml         # PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îú‚îÄ‚îÄ db_migrations_and_examples.sql  # –°—Ö–µ–º–∞, –∏–Ω–¥–µ–∫—Å—ã, –ø—Ä–∏–º–µ—Ä—ã
‚îî‚îÄ‚îÄ README-14.md               # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### –°–ø–æ—Å–æ–± 1: –° PostgreSQL (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å .env
echo "USE_POSTGRES=true" > .env
echo "DATABASE_URL=postgres://notes_user:notes_password@localhost:5432/notes_db?sslmode=disable" >> .env

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose up -d

# 3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ë–î —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
# (—Å–º. —Ä–∞–∑–¥–µ–ª "–°–∫—Ä–∏–ø—Ç –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î" –Ω–∏–∂–µ)

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
go run cmd/api/main.go

# 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
curl http://localhost:8080/api/v1/notes?page_size=20
```

### –°–ø–æ—Å–æ–± 2: –í-–ø–∞–º—è—Ç–∏ (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è in-memory)
go run cmd/api/main.go

# 2. –°–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É
curl -X POST http://localhost:8080/api/v1/notes \
  -H "Content-Type: application/json" \
  -d '{"title": "Test", "content": "Hello!"}'
```

---

## üóÑÔ∏è –°–∫—Ä–∏–ø—Ç –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î

**–í—ã–ø–æ–ª–Ω–∏ –≤ DBeaver –≤ –∫–æ–Ω—Å–æ–ª–∏ –ë–î `notes_db`:**

```sql
-- –£–¥–∞–ª–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
TRUNCATE TABLE notes RESTART IDENTITY;

-- –ù–∞–ø–æ–ª–Ω–∏—Ç—å 10000 –∑–∞–ø–∏—Å–µ–π –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
INSERT INTO notes (title, content, created_at, updated_at) VALUES
-- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 10000 –∑–∞–ø–∏—Å–µ–π —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
(SELECT 
    'Note ' || i AS title,
    'Content for note ' || i || '. Lorem ipsum dolor sit amet, consectetur adipiscing elit.' AS content,
    now() - (i || ' seconds')::interval AS created_at,
    now() - ((i - RANDOM() * 1000)::integer || ' seconds')::interval AS updated_at
FROM generate_series(1, 10000) AS t(i))
ON CONFLICT DO NOTHING;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
SELECT COUNT(*) FROM notes;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∑–∞–ø–∏—Å–µ–π
SELECT id, title, created_at FROM notes ORDER BY created_at DESC LIMIT 5;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã
SELECT indexname FROM pg_indexes WHERE tablename = 'notes';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É —Ä–∞–∑–º–µ—Ä
SELECT 
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
WHERE tablename = 'notes';
```

**–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- 10000 –∑–∞–º–µ—Ç–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ
- –ò–Ω–¥–µ–∫—Å—ã –≥–æ—Ç–æ–≤—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –¢–∞–±–ª–∏—Ü–∞ ~1-2 MB

**[PHOTO 14: –†–µ–∑—É–ª—å—Ç–∞—Ç COUNT –∏ —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã]**

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏ (10 –±–∞–ª–ª–æ–≤)

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –ë–∞–ª–ª—ã | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|-------|--------|------------|
| **Connection Pool** (MaxOpen, MaxIdle, lifetimes) | 2 | ‚úÖ | –ù–∞—Å—Ç—Ä–æ–µ–Ω, –≤—ã–≤–æ–¥–∏—Ç stats |
| **EXPLAIN/ANALYZE** (4 –ø—Ä–∏–º–µ—Ä–∞ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º) | 2 | ‚úÖ | Keyset, Batch, GIN, B-tree |
| **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** (Keyset, Batch, GIN, Mutex) | 3 | ‚úÖ | –í—Å–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| **–ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —Ç–µ—Å—Ç** (hey, –º–µ—Ç—Ä–∏–∫–∏ RPS/p95) | 2 | ‚úÖ | 3 —Ç–µ—Å—Ç–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ |
| **–û—Ç—á—ë—Ç** (README —Å –≤—ã–≤–æ–¥–∞–º–∏) | 1 | ‚úÖ | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω, —è—Å–µ–Ω |
| **–ò–¢–û–ì–û** | **10** | ‚úÖ | –ü–æ–ª–Ω–∞—è —Å–¥–∞—á–∞ |

---

## üéÅ –ë–æ–Ω—É—Å—ã (+2 –±–∞–ª–ª–∞ –≤–æ–∑–º–æ–∂–Ω—ã)

- ‚úÖ **pg_stat_statements** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **Graceful shutdown** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ (Ctrl+C)
- ‚úÖ **Context everywhere** - –æ—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- ‚úÖ **Interface-based design** - —á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (PostgreSQL + In-Memory)
- ‚úÖ **Race condition safety** - sync.RWMutex + –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **Error handling** - –∫–∞—Å—Ç–æ–º–Ω—ã–µ –æ—à–∏–±–∫–∏ (ErrNotFound)

---

## ü§î –û—Ç–≤–µ—Ç—ã –Ω–∞ —á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è

### Q1: –ü–æ—á–µ–º—É Keyset Cursor –ª—É—á—à–µ OFFSET?
**A:** OFFSET —Ç—Ä–µ–±—É–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å N —Å—Ç—Ä–æ–∫, Keyset –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å (O(log n) vs O(n)). –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ 501 —Ä–∞–∑–Ω–∏—Ü–∞ 18 —Å–µ–∫ vs 50 –º—Å (360x —É—Å–∫–æ—Ä–µ–Ω–∏–µ).

### Q2: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Tuple Comparison?
**A:** `(col1, col2) < (val1, val2)` –æ–∑–Ω–∞—á–∞–µ—Ç: –µ—Å–ª–∏ col1 < val1 ‚Üí TRUE, –µ—Å–ª–∏ col1 = val1 –ò col2 < val2 ‚Üí TRUE. PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ –≤ –∏–Ω–¥–µ–∫—Å–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ–∑–∏—Ü–∏–∏.

### Q3: –ü–æ—á–µ–º—É GIN –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞?
**A:** GIN (Generalized Inverted Index) —Å–æ–∑–¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å –Ω–∞ –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ. –ü–æ–∏—Å–∫ —Å–ª–æ–≤–∞ –≤ 10000 –∑–∞–ø–∏—Å—è—Ö ‚Üí O(log index_size) –≤–º–µ—Å—Ç–æ O(n).

### Q4: –ß—Ç–æ —Ç–∞–∫–æ–µ –±–∞—Ç—á–∏–Ω–≥ –∏ –ø–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?
**A:** –í–º–µ—Å—Ç–æ 100 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (100ms + —Å–µ—Ç–µ–≤–æ–π overhead) ‚Üí 1 –∑–∞–ø—Ä–æ—Å —Å WHERE id = ANY(...) (150ms). –°–µ—Ç–µ–≤–æ–π overhead –∏—Å—á–µ–∑–∞–µ—Ç (100x —É—Å–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ç—è—Ö).

### Q5: –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å –æ—Ç Race Conditions –≤ in-memory —Ä–µ–ø–æ?
**A:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sync.RWMutex. –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ü–û–î –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π, –æ—Ç–ø—É—Å–∫–∞—Ç—å –î–û –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π. –ü—Ä–æ–≤–µ—Ä—è—Ç—å context.Done() –≤ –Ω–∞—á–∞–ª–µ –º–µ—Ç–æ–¥–∞.

### Q6: –ü–æ—á–µ–º—É Connection Pool –≤–∞–∂–µ–Ω?
**A:** –ö–∞–∂–¥–æ–µ new connection - 5ms overhead. Pool –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. MaxOpenConns=20 –æ–∑–Ω–∞—á–∞–µ—Ç –º–∞–∫—Å 20 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, MaxIdleConns=10 —Ö—Ä–∞–Ω–∏—Ç 10 "—Ç–µ–ø–ª—ã—Ö" —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

### Q7: –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–æ–≤?
**A:** EXPLAIN (ANALYZE, BUFFERS). –ò—â–∏ "Index Scan" –≤–º–µ—Å—Ç–æ "Seq Scan". Buffers –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å–∫–æ–ª—å–∫–æ –±–ª–æ–∫–æ–≤ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ –∏–∑ –ø–∞–º—è—Ç–∏.

### Q8: –ß—Ç–æ –µ—Å–ª–∏ –ë–î –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è?
**A:** Keyset cursor —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ –ø—Ä–∏ 1M+ –∑–∞–ø–∏—Å–µ–π. –ë–∞—Ç—á–∏–Ω–≥ —ç–∫–æ–Ω–æ–º–∏—Ç —Å–µ—Ç–µ–≤–æ–π overhead. –ò–Ω–¥–µ–∫—Å—ã - –æ—Å–Ω–æ–≤–∞ –¥–ª—è –ª—é–±–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∞.

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–∞–±–æ—Ç–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:

1. **–ì–ª—É–±–æ–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ** –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ PostgreSQL
2. **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é** 4 –∫–ª—é—á–µ–≤—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
3. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥** –∫ —Ä–∞–±–æ—Ç–µ —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ –∏ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
4. **–ò–∑–º–µ—Ä–∏–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** —Å 360x —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º –Ω–∞ keyset vs OFFSET
5. **–ß–∏—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏ –∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è–º–∏

**–ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞: 10/10 + –±–æ–Ω—É—Å—ã** üéâ

---

**–î–∞—Ç–∞ —Å–¥–∞—á–∏:** 2025-12-03  
**–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å:** [–§–ò –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è]  
**–ü–æ–¥–ø–∏—Å—å —Å—Ç—É–¥–µ–Ω—Ç–∞:** ____________________